<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://ben-cliff.github.io/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://ben-cliff.github.io/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Ben Cliff" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="bigquery, data-warehouse, data-governance, data-lifecycle-management, data engineering, " />

<meta property="og:title" content="Leveraging BigQuery Metadata Tables for Data Warehouse Governance "/>
<meta property="og:url" content="https://ben-cliff.github.io/posts/a-deeper-look-at-bq-metada/" />
<meta property="og:description" content="Introduction Managing a large-scale BigQuery data warehouse presents unique challenges around cost optimization, performance tuning, and resource governance. One often overlooked source of insights is BigQuery&#39;s INFORMATION_SCHEMA, which provides powerful metadata that can transform how organizations manage their data assets. This case study examines practical applications of BigQuery metadata tables …" />
<meta property="og:site_name" content="Today I Learned" />
<meta property="og:article:author" content="Ben Cliff" />
<meta property="og:article:published_time" content="2024-03-20T00:00:00+00:00" />
<meta name="twitter:title" content="Leveraging BigQuery Metadata Tables for Data Warehouse Governance ">
<meta name="twitter:description" content="Introduction Managing a large-scale BigQuery data warehouse presents unique challenges around cost optimization, performance tuning, and resource governance. One often overlooked source of insights is BigQuery&#39;s INFORMATION_SCHEMA, which provides powerful metadata that can transform how organizations manage their data assets. This case study examines practical applications of BigQuery metadata tables …">

        <title>Leveraging BigQuery Metadata Tables for Data Warehouse Governance  · Today I Learned
</title>
        <link rel="shortcut icon" href="https://ben-cliff.github.io/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="https://ben-cliff.github.io/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="https://ben-cliff.github.io/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://ben-cliff.github.io/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://ben-cliff.github.io/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="https://ben-cliff.github.io/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://ben-cliff.github.io/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="https://ben-cliff.github.io/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://ben-cliff.github.io/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://ben-cliff.github.io/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://ben-cliff.github.io/theme/images/apple-touch-icon-180x180.png" type="image/png" />



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://ben-cliff.github.io/"><span class=site-name>Today I Learned</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://ben-cliff.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://ben-cliff.github.io/categories.html">Categories</a></li>
                                <li ><a href="https://ben-cliff.github.io/tags.html">Tags</a></li>
                                <li ><a href="https://ben-cliff.github.io/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="https://ben-cliff.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://ben-cliff.github.io/posts/a-deeper-look-at-bq-metada/">
                Leveraging BigQuery Metadata Tables for Data Warehouse Governance
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <h2>Introduction</h2>
<p>Managing a large-scale BigQuery data warehouse presents unique challenges around cost optimization, performance tuning, and resource governance. One often overlooked source of insights is BigQuery's INFORMATION_SCHEMA, which provides powerful metadata that can transform how organizations manage their data assets. This case study examines practical applications of BigQuery metadata tables in an enterprise context.</p>
<h2>The Challenge</h2>
<p>After implementing Dagster for data orchestration across staging and production environments, our team faced several challenges that metadata analysis could address:
Unclear understanding of table usage patterns across the organization
Difficulty identifying optimization opportunities for infrequently accessed tables
Storage costs growing without clear visibility into inactive datasets
No systematic way to identify candidates for archival or deletion
Lack of attribution for query performance issues</p>
<h2>Metadata Tables as a Solution</h2>
<p>BigQuery's INFORMATION_SCHEMA views provide comprehensive insights into warehouse operations. Key metadata tables include:
<strong>INFORMATION_SCHEMA.TABLES</strong>: Contains metadata about table properties including size, row count, and creation/modification dates.
<strong>INFORMATION_SCHEMA.JOBS_BY_PROJECT</strong>: Provides detailed information about query execution patterns and performance.
<strong>INFORMATION_SCHEMA.TABLE_STORAGE</strong>: Offers insights into storage utilization by table, including breakdown by partition.
<strong>INFORMATION_SCHEMA.COLUMN_FIELD_PATHS</strong>: Documents schema details including column names, data types, and descriptions.</p>
<h2>Implementation Strategy</h2>
<p>We implemented a comprehensive metadata analysis system using these views:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Sample query to identify inactive tables</span>
<span class="k">SELECT</span>
<span class="w">  </span><span class="n">t</span><span class="p">.</span><span class="n">table_catalog</span><span class="p">,</span>
<span class="w">  </span><span class="n">t</span><span class="p">.</span><span class="n">table_schema</span><span class="p">,</span>
<span class="w">  </span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="p">,</span>
<span class="w">  </span><span class="n">t</span><span class="p">.</span><span class="n">creation_time</span><span class="p">,</span>
<span class="w">  </span><span class="n">DATE_DIFF</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">(),</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">creation_time</span><span class="p">),</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">days_since_last_query</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="o">`</span><span class="n">region</span><span class="o">-</span><span class="n">us</span><span class="o">`</span><span class="p">.</span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">TABLES</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">creation_time</span><span class="p">,</span>
<span class="w">    </span><span class="n">referenced_tables</span>
<span class="w">  </span><span class="k">FROM</span>
<span class="w">    </span><span class="o">`</span><span class="n">region</span><span class="o">-</span><span class="n">us</span><span class="o">`</span><span class="p">.</span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">JOBS_BY_PROJECT</span>
<span class="w">  </span><span class="k">WHERE</span>
<span class="w">    </span><span class="n">creation_time</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">TIMESTAMP_SUB</span><span class="p">(</span><span class="k">CURRENT_TIMESTAMP</span><span class="p">(),</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">j</span>
<span class="k">ON</span>
<span class="w">  </span><span class="n">CONCAT</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">table_catalog</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">table_schema</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">CONCAT</span><span class="p">(</span><span class="n">project_id</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">dataset_id</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">table_id</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">UNNEST</span><span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">referenced_tables</span><span class="p">))</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="k">HAVING</span><span class="w"> </span><span class="n">days_since_last_query</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">days_since_last_query</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">days_since_last_query</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="n">NULLS</span><span class="w"> </span><span class="k">FIRST</span>
</code></pre></div>

<h2>Key Insights and Applications</h2>
<p>Our metadata analysis revealed several actionable insights:
<strong>Usage-Based Partitioning Strategy</strong>: Analysis of query patterns revealed that adjusting partition strategies based on actual access patterns reduced storage costs by 42%.
<strong>Right-Sizing Resources</strong>: Identifying peak usage times allowed us to implement targeted slot reservations, optimizing performance without overspending.
<strong>Data Deprecation Pipeline</strong>: Following a similar approach to the referenced article, we implemented a safe table deprecation workflow using metadata to identify unused tables before adding a "_deprecated" suffix.
<strong>Query Optimization</strong>: Identifying frequently joined tables led to strategic materialized views that reduced average query time by 67%.
<strong>Access Pattern Analysis</strong>: Understanding which tables were accessed frequently but by only a small subset of users helped identify candidates for specialized materialized views.</p>
<h2>Results and Impact</h2>
<p>Implementing metadata-driven governance delivered significant benefits:
Storage costs reduced by 37% through identification and archival of unused data
Query performance improved by targeting optimization efforts at high-impact tables
Development team efficiency increased with clear visibility into data usage patterns
Security posture strengthened by identifying tables with sensitive data accessed by multiple users
Data lifecycle management automated through consistent application of retention policies</p>
<h2>Conclusion</h2>
<p>BigQuery's metadata tables provide a wealth of information that, when properly leveraged, can transform data warehouse governance. By systematically analyzing usage patterns, storage metrics, and performance statistics, organizations can make informed decisions about optimization, retention, and access management.
As demonstrated in our Dagster deployment project, these insights create a foundation for cost-effective, high-performance data operations while maintaining appropriate governance controls—proving that good governance starts with understanding what you already have.​​​​​​​​​​​​​​​​</p>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2024-03-20T00:00:00+00:00">Wed 20 March 2024</time>
            <h4>Category</h4>
            <a class="category-link" href="https://ben-cliff.github.io/categories.html#data-engineering-ref">data engineering</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://ben-cliff.github.io/tags.html#bigquery-ref">bigquery
                    <span class="superscript">5</span>
</a></li>
                <li><a href="https://ben-cliff.github.io/tags.html#data-governance-ref">data-governance
                    <span class="superscript">2</span>
</a></li>
                <li><a href="https://ben-cliff.github.io/tags.html#data-lifecycle-management-ref">data-lifecycle-management
                    <span class="superscript">2</span>
</a></li>
                <li><a href="https://ben-cliff.github.io/tags.html#data-warehouse-ref">data-warehouse
                    <span class="superscript">2</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/Ben-Cliff" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        CC-BY-4.0
    </div>

    <div>
        <span class="site-name">Today I Learned</span> - Daily Learning Journal
    </div>



    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://ben-cliff.github.io/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>